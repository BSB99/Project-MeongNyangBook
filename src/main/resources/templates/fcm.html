<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>

    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-messaging.js"></script>
</head>
<body>
<p>test</p>

<script>

    document.addEventListener("DOMContentLoaded", function () {
        const firebaseConfig = {
            apiKey: "AIzaSyCIoZVCfP5XG038Jald_Q9BxphVkEPiCZc",
            authDomain: "meongnyangbook.firebaseapp.com",
            projectId: "meongnyangbook",
            storageBucket: "meongnyangbook.appspot.com",
            messagingSenderId: "1044918801546",
            appId: "1:1044918801546:web:70dc543eaaac987c820973",
            measurementId: "G-JYXQFCBL5J"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Initialize Firebase Cloud Messaging and get a reference to the service
        const messaging = firebase.messaging();

        // Get registration token.
        messaging.getToken({ vapidKey: 'BOg78AzxKfvkR97RRlaejNe1WrkrRi4lWJYkYQqIpihuEmFM4ld_w-vl9Z1ydiYBp_ywFs_jHYmjDu-yBZEt52M' }).then((currentToken) => {
            if (currentToken) {
                token = currentToken;
                const title = "알림 제목";
                const body = "알림 내용";
                sendNotification(token, title, body);
            } else {
                console.log('No registration token available. Request permission to generate one.');
            }
        }).catch((err) => {
            console.log('An error occurred while retrieving token. ', err);
        });

        const sendNotification = async (token, title, body) => {
            const url = `/api/notifications/send?token=${token}&title=${title}&body=${body}`;
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
            });

            const data = await response.json();
            console.log(data);
        };

        messaging.onMessage((payload) => {
            console.log('Message received:', payload);

            // 페이로드를 사용하여 브라우저 알림 표시
            const notificationTitle = payload.notification.title;
            const notificationOptions = {
                body: payload.notification.body,
                icon: payload.notification.icon, // 필요하다면 아이콘도 설정
                // 추가 옵션들...
            };

            new Notification(notificationTitle, notificationOptions);
        });
    });

</script>
</body>
</html>
